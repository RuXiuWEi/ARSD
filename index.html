<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>品牌商后台基础-操作日志管理</title>
    <!-- 引入Element Plus样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <!-- 引入Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- 引入Element Plus组件库 -->
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <!-- 引入Element Plus图标 -->
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1600px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
            border-radius: 10px; 
            margin-bottom: 30px; 
        }
        .filter-section, .logs-section { 
            background: white; 
            border-radius: 10px; 
            padding: 25px; 
            margin-bottom: 30px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .filter-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-bottom: 20px; 
        }
        .btn-group { 
            display: flex; 
            gap: 10px; 
            justify-content: center; 
        }
        .detail-section { 
            margin-bottom: 25px; 
        }
        .detail-section h4 { 
            color: #667eea; 
            margin-bottom: 15px; 
            border-bottom: 1px solid #eee; 
            padding-bottom: 8px; 
        }
        .detail-item { 
            display: flex; 
            margin-bottom: 10px; 
            padding: 8px 0; 
            border-bottom: 1px solid #f5f5f5; 
        }
        .detail-label { 
            font-weight: bold; 
            width: 120px; 
            color: #555; 
        }
        .detail-value { 
            flex: 1; 
            color: #333; 
        }
        .change-item { 
            background: #f8f9fa; 
            padding: 10px; 
            border-radius: 5px; 
            margin: 5px 0; 
        }
        .change-before { 
            color: #dc3545; 
        }
        .change-after { 
            color: #28a745; 
        }
        .search-highlight { 
            background-color: #fff3cd; 
            padding: 2px 4px; 
            border-radius: 3px; 
        }
        .log-level-system { 
            color: #e6a23c; 
            font-weight: bold; 
        }
        .log-level-app { 
            color: #409eff; 
            font-weight: bold; 
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>品牌商后台基础_操作日志管理</h1>
                <p>基于ARSD模板生成的演示</p>
            </div>

            <div class="filter-section">
                <h3>筛选条件</h3>
                <div class="filter-grid">
                    <el-form-item label="操作时间范围">
                        <el-date-picker
                            v-model="filters.dateRange"
                            type="daterange"
                            range-separator="至"
                            start-placeholder="开始日期"
                            end-placeholder="结束日期"
                            format="YYYY-MM-DD"
                            value-format="YYYY-MM-DD"
                            :default-value="defaultDateRange">
                        </el-date-picker>
                    </el-form-item>
                    
                    <el-form-item label="操作人">
                        <el-input
                            v-model="filters.operator"
                            placeholder="输入操作人姓名或账号"
                            clearable>
                        </el-input>
                    </el-form-item>
                    
                    <el-form-item label="操作人IP">
                        <el-input
                            v-model="filters.operatorIP"
                            placeholder="输入IP地址"
                            clearable>
                        </el-input>
                    </el-form-item>
                    
                    <el-form-item label="日志层级">
                        <el-select
                            v-model="filters.logLevel"
                            placeholder="选择日志层级"
                            clearable
                            @change="handleLogLevelChange">
                            <el-option label="全部" value=""></el-option>
                            <el-option label="系统级" value="系统级"></el-option>
                            <el-option label="应用级" value="应用级"></el-option>
                        </el-select>
                    </el-form-item>
                    
                    <el-form-item label="所属应用">
                        <el-select
                            v-model="filters.application"
                            placeholder="选择所属应用"
                            clearable
                            @change="handleApplicationChange">
                            <el-option label="全部" value=""></el-option>
                            <el-option 
                                v-for="app in availableApplications" 
                                :key="app" 
                                :label="app" 
                                :value="app">
                            </el-option>
                        </el-select>
                    </el-form-item>
                    
                    <el-form-item label="操作模块">
                        <el-select
                            v-model="filters.module"
                            placeholder="选择操作模块"
                            clearable>
                            <el-option label="全部" value=""></el-option>
                            <el-option 
                                v-for="module in availableModules" 
                                :key="module" 
                                :label="module" 
                                :value="module">
                            </el-option>
                        </el-select>
                    </el-form-item>
                    
                    <el-form-item label="操作项">
                        <el-input
                            v-model="filters.operationItem"
                            placeholder="输入操作项关键词"
                            clearable>
                        </el-input>
                    </el-form-item>
                    
                    <el-form-item label="执行结果">
                        <el-select
                            v-model="filters.result"
                            placeholder="选择执行结果"
                            clearable>
                            <el-option label="全部" value=""></el-option>
                            <el-option label="成功" value="成功"></el-option>
                            <el-option label="失败" value="失败"></el-option>
                        </el-select>
                    </el-form-item>
                </div>
                
                <div class="btn-group">
                    <el-button type="primary" @click="searchLogs" :icon="Search">查询</el-button>
                    <el-button @click="resetFilters" :icon="Refresh">重置</el-button>
                </div>
            </div>

            <div class="logs-section">
                <h3>操作日志列表</h3>
                <el-table
                    :data="displayedLogs"
                    style="width: 100%"
                    :default-sort="{prop: 'time', order: 'descending'}"
                    stripe
                    border
                    max-height="600">
                    <el-table-column prop="time" label="操作时间" sortable width="180"></el-table-column>
                    <el-table-column prop="operator" label="操作人" width="120">
                        <template #default="scope">
                            <span v-html="highlightSearch(scope.row.operator)"></span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="operatorIP" label="操作人IP" width="130"></el-table-column>
                    <el-table-column prop="logLevel" label="日志层级" width="100">
                        <template #default="scope">
                            <span :class="scope.row.logLevel === '系统级' ? 'log-level-system' : 'log-level-app'">
                                {{ scope.row.logLevel }}
                            </span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="application" label="所属应用" width="150"></el-table-column>
                    <el-table-column prop="module" label="操作模块" width="150"></el-table-column>
                    <el-table-column prop="path" label="具体路径" width="200"></el-table-column>
                    <el-table-column prop="operationItem" label="操作项" width="150">
                        <template #default="scope">
                            <span v-html="highlightSearch(scope.row.operationItem)"></span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="result" label="执行状态" width="100">
                        <template #default="scope">
                            <el-tag :type="scope.row.result === '成功' ? 'success' : 'danger'">
                                {{ scope.row.result }}
                            </el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column label="操作" width="100" fixed="right">
                        <template #default="scope">
                            <el-button
                                size="small"
                                type="primary"
                                @click="showDetail(scope.row)">
                                详情
                            </el-button>
                        </template>
                    </el-table-column>
                </el-table>
                
                <div style="margin-top: 20px; text-align: center;">
                    <el-pagination
                        v-model:current-page="currentPage"
                        v-model:page-size="pageSize"
                        :page-sizes="[10, 20, 50, 100]"
                        :total="displayedLogs.length"
                        layout="total, sizes, prev, pager, next, jumper"
                        @size-change="handleSizeChange"
                        @current-change="handleCurrentChange">
                    </el-pagination>
                </div>
            </div>
        </div>

        <!-- 操作详情抽屉 -->
        <el-drawer
            v-model="drawerVisible"
            title="操作详情"
            direction="rtl"
            size="700px">
            <div class="drawer-content">
                <div class="detail-section">
                    <h4>基本信息</h4>
                    <div class="detail-item">
                        <span class="detail-label">操作ID:</span>
                        <span class="detail-value">{{ currentLog.id }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">操作时间:</span>
                        <span class="detail-value">{{ currentLog.time }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">操作人:</span>
                        <span class="detail-value">{{ currentLog.operator }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">操作人IP:</span>
                        <span class="detail-value">{{ currentLog.operatorIP }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">日志层级:</span>
                        <span class="detail-value">
                            <span :class="currentLog.logLevel === '系统级' ? 'log-level-system' : 'log-level-app'">
                                {{ currentLog.logLevel }}
                            </span>
                        </span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">所属应用:</span>
                        <span class="detail-value">{{ currentLog.application }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">操作模块:</span>
                        <span class="detail-value">{{ currentLog.module }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">具体路径:</span>
                        <span class="detail-value">{{ currentLog.path }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">操作项:</span>
                        <span class="detail-value">{{ currentLog.operationItem }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">执行状态:</span>
                        <span class="detail-value">
                            <el-tag :type="currentLog.result === '成功' ? 'success' : 'danger'">
                                {{ currentLog.result }}
                            </el-tag>
                        </span>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4>操作详情</h4>
                    <div v-if="currentLog.details">
                        <!-- 新增类操作详情 -->
                        <div v-if="currentLog.operationItem.includes('新增') || currentLog.operationItem.includes('上传')" class="detail-item">
                            <span class="detail-label">{{ currentLog.operationItem }}详情:</span>
                            <div class="detail-value">
                                <div v-for="(value, key) in currentLog.details" :key="key" v-if="key !== 'operationId'">
                                    {{ getFieldLabel(key) }}: {{ value }}
                                </div>
                            </div>
                        </div>
                        
                        <!-- 修改类操作详情 -->
                        <div v-else-if="currentLog.operationItem.includes('修改') || currentLog.operationItem.includes('编辑')" class="detail-item">
                            <span class="detail-label">{{ currentLog.operationItem }}详情:</span>
                            <div class="detail-value">
                                <div v-for="change in currentLog.details.changes" :key="change.field" class="change-item">
                                    <span class="change-before">{{ getFieldLabel(change.field) }}: {{ change.before }}</span>
                                    <span> → </span>
                                    <span class="change-after">{{ change.after }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 删除类操作详情 -->
                        <div v-else-if="currentLog.operationItem.includes('删除')" class="detail-item">
                            <span class="detail-label">{{ currentLog.operationItem }}详情:</span>
                            <div class="detail-value">
                                <div v-for="(value, key) in getDeletedInfo(currentLog.details)" :key="key">
                                    {{ getFieldLabel(key) }}: {{ value }}
                                </div>
                            </div>
                        </div>
                        
                        <!-- 导入类操作详情 -->
                        <div v-else-if="currentLog.operationItem.includes('导入')" class="detail-item">
                            <span class="detail-label">{{ currentLog.operationItem }}详情:</span>
                            <div class="detail-value">
                                <div class="detail-item">
                                    <span class="detail-label">导入文件:</span>
                                    <span class="detail-value">
                                        <el-link :href="currentLog.details.importFile" target="_blank" type="primary">
                                            {{ currentLog.details.importFile }}
                                        </el-link>
                                    </span>
                                </div>
                                <div v-if="currentLog.details.importedCount" class="detail-item">
                                    <span class="detail-label">导入数量:</span>
                                    <span class="detail-value">{{ currentLog.details.importedCount }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 导出类操作详情 -->
                        <div v-else-if="currentLog.operationItem.includes('导出')" class="detail-item">
                            <span class="detail-label">{{ currentLog.operationItem }}详情:</span>
                            <div class="detail-value">
                                <div class="detail-item">
                                    <span class="detail-label">导出文件:</span>
                                    <span class="detail-value">
                                        <el-link :href="currentLog.details.exportFile" target="_blank" type="primary">
                                            {{ currentLog.details.exportFile }}
                                        </el-link>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 还原类操作详情 -->
                        <div v-else-if="currentLog.operationItem.includes('还原')" class="detail-item">
                            <span class="detail-label">{{ currentLog.operationItem }}详情:</span>
                            <div class="detail-value">
                                <div class="detail-item">
                                    <span class="detail-label">操作ID:</span>
                                    <span class="detail-value">{{ currentLog.details.operationId }}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">说明:</span>
                                    <span class="detail-value">可通过删除日志查看详情，避免累赘</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 彻底删除类操作详情 -->
                        <div v-else-if="currentLog.operationItem.includes('彻底删除')" class="detail-item">
                            <span class="detail-label">{{ currentLog.operationItem }}详情:</span>
                            <div class="detail-value">
                                <div class="detail-item">
                                    <span class="detail-label">操作ID:</span>
                                    <span class="detail-value">{{ currentLog.details.operationId }}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">说明:</span>
                                    <span class="detail-value">可通过删除日志查看详情，避免累赘</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 默认情况 -->
                        <div v-else class="detail-item">
                            <span class="detail-label">{{ currentLog.operationItem }}详情:</span>
                            <div class="detail-value">
                                <div v-for="(value, key) in currentLog.details" :key="key" v-if="key !== 'operationId'">
                                    {{ getFieldLabel(key) }}: {{ value }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </el-drawer>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        const { Search, Refresh } = ElementPlusIconsVue;

        createApp({
            setup() {
                const mockLogs = ref([
                    // 产品库-产品管理
                    {
                        id: "275256",
                        time: "2024-01-05 14:30:25",
                        operator: "张三",
                        operatorIP: "192.168.1.100",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-产品库-产品管理",
                        operationItem: "上传产品",
                        result: "成功",
                        details: {
                            operationId: "275256",
                            productName: "百威啤酒",
                            productType: "实物商品",
                            price: "15.00",
                            stock: "1000",
                            brand: "百威",
                            category: "啤酒"
                        }
                    },
                    {
                        id: "277649",
                        time: "2024-01-05 15:20:10",
                        operator: "李四",
                        operatorIP: "192.168.1.101",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-产品库-产品管理",
                        operationItem: "编辑产品",
                        result: "成功",
                        details: {
                            operationId: "277649",
                            changes: [
                                { field: "价格", before: "118", after: "128" },
                                { field: "总库存", before: "100", after: "500" }
                            ]
                        }
                    },
                    {
                        id: "277650",
                        time: "2024-01-05 16:15:30",
                        operator: "张三",
                        operatorIP: "192.168.1.100",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-产品库-产品管理",
                        operationItem: "删除产品",
                        result: "成功",
                        details: {
                            operationId: "277650",
                            deletedProduct: {
                                productName: "过期产品",
                                productType: "实物商品",
                                price: "50.00",
                                brand: "过期品牌",
                                category: "过期分类"
                            }
                        }
                    },
                    {
                        id: "277651",
                        time: "2024-01-05 17:00:45",
                        operator: "王五",
                        operatorIP: "192.168.1.102",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-产品库-产品管理",
                        operationItem: "批量导入产品",
                        result: "成功",
                        details: {
                            operationId: "277651",
                            importFile: "https://example.com/files/products_20240105.xlsx",
                            importedCount: "150"
                        }
                    },
                    {
                        id: "277652",
                        time: "2024-01-05 18:30:20",
                        operator: "赵六",
                        operatorIP: "192.168.1.103",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-产品库-产品管理",
                        operationItem: "导出产品",
                        result: "成功",
                        details: {
                            operationId: "277652",
                            exportFile: "https://example.com/files/products_export_20240105.xlsx"
                        }
                    },
                    {
                        id: "277653",
                        time: "2024-01-05 19:15:10",
                        operator: "张三",
                        operatorIP: "192.168.1.100",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-产品库-产品管理",
                        operationItem: "还原产品",
                        result: "成功",
                        details: {
                            operationId: "277653"
                        }
                    },
                    {
                        id: "277654",
                        time: "2024-01-05 20:00:00",
                        operator: "李四",
                        operatorIP: "192.168.1.101",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-产品库-产品管理",
                        operationItem: "彻底删除产品",
                        result: "成功",
                        details: {
                            operationId: "277654"
                        }
                    },
                    
                    // 产品库-产品分类
                    {
                        id: "277655",
                        time: "2024-01-06 09:00:00",
                        operator: "王五",
                        operatorIP: "192.168.1.102",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-产品库-产品分类",
                        operationItem: "新增一级分类",
                        result: "成功",
                        details: {
                            operationId: "277655",
                            categoryName: "酒类",
                            categoryLevel: "一级分类"
                        }
                    },
                    {
                        id: "277656",
                        time: "2024-01-06 10:30:00",
                        operator: "赵六",
                        operatorIP: "192.168.1.103",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-产品库-产品分类",
                        operationItem: "新增二级分类",
                        result: "成功",
                        details: {
                            operationId: "277656",
                            categoryName: "白酒",
                            parentCategory: "酒类",
                            categoryLevel: "二级分类"
                        }
                    },
                    {
                        id: "277657",
                        time: "2024-01-06 11:15:00",
                        operator: "张三",
                        operatorIP: "192.168.1.100",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-产品库-产品分类",
                        operationItem: "修改分类",
                        result: "成功",
                        details: {
                            operationId: "277657",
                            changes: [
                                { field: "分类名称", before: "白酒", after: "酒" }
                            ]
                        }
                    },
                    {
                        id: "277658",
                        time: "2024-01-06 14:20:00",
                        operator: "李四",
                        operatorIP: "192.168.1.101",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-产品库-产品分类",
                        operationItem: "删除分类",
                        result: "成功",
                        details: {
                            operationId: "277658",
                            deletedCategory: {
                                categoryName: "白酒",
                                parentCategory: "酒类",
                                categoryLevel: "二级分类"
                            }
                        }
                    },
                    
                    // 产品库-礼品库-自有礼品
                    {
                        id: "277659",
                        time: "2024-01-06 15:45:00",
                        operator: "王五",
                        operatorIP: "192.168.1.102",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-礼品库-自有礼品",
                        operationItem: "上传礼品",
                        result: "成功",
                        details: {
                            operationId: "277659",
                            giftName: "百威礼品",
                            giftType: "实物礼品",
                            marketValue: "100元",
                            exchangeMethod: "免费兑换",
                            brand: "百威"
                        }
                    },
                    {
                        id: "277660",
                        time: "2024-01-06 16:30:00",
                        operator: "赵六",
                        operatorIP: "192.168.1.103",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-礼品库-自有礼品",
                        operationItem: "编辑礼品",
                        result: "成功",
                        details: {
                            operationId: "277660",
                            changes: [
                                { field: "礼品名称", before: "百威礼品", after: "巧克力礼品" },
                                { field: "市面价值", before: "100元", after: "200元" }
                            ]
                        }
                    },
                    {
                        id: "277661",
                        time: "2024-01-06 17:15:00",
                        operator: "张三",
                        operatorIP: "192.168.1.100",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-礼品库-自有礼品",
                        operationItem: "删除礼品",
                        result: "成功",
                        details: {
                            operationId: "277661",
                            deletedGift: {
                                giftName: "百威礼品",
                                giftType: "实物礼品",
                                marketValue: "100元",
                                exchangeMethod: "免费兑换",
                                brand: "百威"
                            }
                        }
                    },
                    {
                        id: "277662",
                        time: "2024-01-06 18:00:00",
                        operator: "李四",
                        operatorIP: "192.168.1.101",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-礼品库-自有礼品",
                        operationItem: "导出礼品",
                        result: "成功",
                        details: {
                            operationId: "277662",
                            exportFile: "https://example.com/files/gifts_export_20240106.xlsx"
                        }
                    },
                    
                    // 产品库-礼品库-分组管理
                    {
                        id: "277663",
                        time: "2024-01-07 09:30:00",
                        operator: "王五",
                        operatorIP: "192.168.1.102",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-礼品库-分组管理",
                        operationItem: "编辑分组",
                        result: "成功",
                        details: {
                            operationId: "277663",
                            changes: [
                                { field: "分组名称", before: "集齐换礼", after: "集齐有礼" }
                            ]
                        }
                    },
                    {
                        id: "277664",
                        time: "2024-01-07 10:15:00",
                        operator: "赵六",
                        operatorIP: "192.168.1.103",
                        logLevel: "系统级",
                        application: "品牌商后台基础",
                        module: "产品库",
                        path: "产品库-礼品库-分组管理",
                        operationItem: "删除分组",
                        result: "成功",
                        details: {
                            operationId: "277664",
                            deletedGroup: {
                                groupName: "集齐有礼",
                                groupType: "礼品分组",
                                memberCount: "50"
                            }
                        }
                    }
                ]);

                const filters = ref({
                    dateRange: [],
                    operator: '',
                    operatorIP: '',
                    logLevel: '',
                    application: '',
                    module: '',
                    operationItem: '',
                    result: ''
                });

                const currentPage = ref(1);
                const pageSize = ref(20);
                const drawerVisible = ref(false);
                const currentLog = ref({});
                const displayedLogs = ref([]); // 新增：用于存储筛选后显示的日志

                const defaultDateRange = [
                    new Date('2024-01-01'),
                    new Date('2024-01-07')
                ];

                // 应用和模块的联动数据
                const applicationModuleMap = {
                    "品牌商后台基础": ["产品库", "客户管理", "营销管理", "系统设置"],
                    "微商城": ["商品管理", "订单管理", "用户管理"],
                    "小程序": ["活动管理", "积分管理", "礼品兑换"]
                };

                const availableApplications = computed(() => {
                    if (filters.value.logLevel === '系统级') {
                        return ["品牌商后台基础"];
                    } else if (filters.value.logLevel === '应用级') {
                        return ["微商城", "小程序"];
                    } else {
                        return Object.keys(applicationModuleMap);
                    }
                });

                const availableModules = computed(() => {
                    if (filters.value.application && applicationModuleMap[filters.value.application]) {
                        return applicationModuleMap[filters.value.application];
                    }
                    return [];
                });



                const handleLogLevelChange = () => {
                    filters.value.application = '';
                    filters.value.module = '';
                };

                const handleApplicationChange = () => {
                    filters.value.module = '';
                };

                const searchLogs = () => {
                    // 执行筛选逻辑
                    displayedLogs.value = mockLogs.value.filter(log => {
                        const logDate = new Date(log.time.split(' ')[0]);
                        
                        return (
                            (!filters.value.dateRange || filters.value.dateRange.length === 0 || 
                             (logDate >= new Date(filters.value.dateRange[0]) && 
                              logDate <= new Date(filters.value.dateRange[1]))) &&
                            (!filters.value.operator || log.operator.includes(filters.value.operator)) &&
                            (!filters.value.operatorIP || log.operatorIP.includes(filters.value.operatorIP)) &&
                            (!filters.value.logLevel || log.logLevel === filters.value.logLevel) &&
                            (!filters.value.application || log.application === filters.value.application) &&
                            (!filters.value.module || log.module === filters.value.module) &&
                            (!filters.value.operationItem || log.operationItem.includes(filters.value.operationItem)) &&
                            (!filters.value.result || log.result === filters.value.result)
                        );
                    });
                    currentPage.value = 1;
                };

                const resetFilters = () => {
                    filters.value = {
                        dateRange: [],
                        operator: '',
                        operatorIP: '',
                        logLevel: '',
                        application: '',
                        module: '',
                        operationItem: '',
                        result: ''
                    };
                    displayedLogs.value = [...mockLogs.value]; // 重置时显示所有日志
                    currentPage.value = 1;
                };

                const showDetail = (log) => {
                    currentLog.value = log;
                    drawerVisible.value = true;
                };

                const handleSizeChange = (val) => {
                    pageSize.value = val;
                    currentPage.value = 1;
                };

                const handleCurrentChange = (val) => {
                    currentPage.value = val;
                };

                const highlightSearch = (text) => {
                    const searchTerm = filters.value.operator || filters.value.operationItem;
                    if (!searchTerm) return text;
                    const regex = new RegExp(`(${searchTerm})`, 'gi');
                    return text.replace(regex, '<span class="search-highlight">$1</span>');
                };

                // 获取字段的中文标签
                const getFieldLabel = (key) => {
                    const fieldLabels = {
                        'productName': '产品名称',
                        'productType': '产品类型',
                        'price': '价格',
                        'stock': '库存',
                        'brand': '品牌',
                        'category': '分类',
                        'categoryName': '分类名称',
                        'categoryLevel': '分类级别',
                        'parentCategory': '所属一级分类',
                        'giftName': '礼品名称',
                        'giftType': '礼品类型',
                        'marketValue': '市面价值',
                        'exchangeMethod': '兑换方式',
                        'groupName': '分组名称',
                        'groupType': '分组类型',
                        'memberCount': '成员数量'
                    };
                    return fieldLabels[key] || key;
                };

                // 获取删除信息
                const getDeletedInfo = (details) => {
                    if (details.deletedProduct) return details.deletedProduct;
                    if (details.deletedCategory) return details.deletedCategory;
                    if (details.deletedGift) return details.deletedGift;
                    if (details.deletedGroup) return details.deletedGroup;
                    return {};
                };

                onMounted(() => {
                    // 设置默认时间范围
                    filters.value.dateRange = ['2024-01-01', '2024-01-07'];
                    // 初始化显示所有日志
                    displayedLogs.value = [...mockLogs.value];
                });

                return {
                    mockLogs,
                    filters,
                    currentPage,
                    pageSize,
                    drawerVisible,
                    currentLog,
                    defaultDateRange,
                    availableApplications,
                    availableModules,
                    displayedLogs,
                    handleLogLevelChange,
                    handleApplicationChange,
                    searchLogs,
                    resetFilters,
                    showDetail,
                    handleSizeChange,
                    handleCurrentChange,
                    highlightSearch,
                    getFieldLabel,
                    getDeletedInfo,
                    Search,
                    Refresh
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
